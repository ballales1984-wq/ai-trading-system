# infra/k8s/secrets-configmap.yaml
# AI Trading System - Secrets and ConfigMaps
# ===========================================

---
# ConfigMap for application configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: trading-config
  labels:
    app: ai-trading-system
data:
  # Application settings
  LOG_LEVEL: "INFO"
  ENVIRONMENT: "production"
  TRADING_MODE: "paper"  # paper, live
  
  # Database settings
  DATABASE_URL: "sqlite:///data/trading.db"
  REDIS_URL: "redis://redis:6379"
  
  # API settings
  API_HOST: "0.0.0.0"
  API_PORT: "8000"
  DASHBOARD_PORT: "8050"
  
  # Trading settings
  MAX_POSITION_SIZE: "0.1"
  RISK_PER_TRADE: "0.02"
  MAX_DAILY_LOSS: "0.05"
  MAX_DRAWDOWN: "0.10"
  
  # Monte Carlo settings
  MC_PATHS: "1000"
  MC_STEPS: "50"
  MC_TIME_HORIZON: "1.0"
  
  # Risk settings
  VAR_CONFIDENCE: "0.95"
  MAX_VAR_THRESHOLD: "0.05"
  
  # Symbols to trade
  SYMBOLS: "BTCUSDT,ETHUSDT,BNBUSDT"

---
# Secrets for API keys (base64 encoded)
# NOTE: In production, use sealed-secrets or external secrets manager
apiVersion: v1
kind: Secret
metadata:
  name: trading-secrets
  labels:
    app: ai-trading-system
type: Opaque
data:
  # Exchange API keys
  BINANCE_API_KEY: <base64-encoded-key>
  BINANCE_SECRET_KEY: <base64-encoded-secret>
  BYBIT_API_KEY: <base64-encoded-key>
  BYBIT_SECRET_KEY: <base64-encoded-secret>
  OKX_API_KEY: <base64-encoded-key>
  OKX_SECRET_KEY: <base64-encoded-secret>
  OKX_PASSPHRASE: <base64-encoded-passphrase>
  
  # Data provider API keys
  NEWSAPI_KEY: <base64-encoded-key>
  ALPHA_VANTAGE_API_KEY: <base64-encoded-key>
  QUANDL_API_KEY: <base64-encoded-key>
  TRADING_ECONOMICS_API_KEY: <base64-encoded-key>
  EIA_API_KEY: <base64-encoded-key>
  TWITTER_BEARER_TOKEN: <base64-encoded-token>
  BENZINGA_API_KEY: <base64-encoded-key>
  NASDAQ_DATA_LINK_KEY: <base64-encoded-key>
  
  # Database credentials
  DATABASE_USER: <base64-encoded-user>
  DATABASE_PASSWORD: <base64-encoded-password>
  
  # Redis password
  REDIS_PASSWORD: <base64-encoded-password>

---
# Alternative: External Secrets (recommended for production)
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: trading-secrets
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secretsmanager
#     kind: SecretStore
#   target:
#     name: trading-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: BINANCE_API_KEY
#       remoteRef:
#         key: trading/binance
#         property: api_key

---
# Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: ai-trading-sa
  labels:
    app: ai-trading-system
automountServiceAccountToken: true

---
# Role for the service account
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ai-trading-role
  labels:
    app: ai-trading-system
rules:
  - apiGroups: [""]
    resources: ["pods", "secrets", "configmaps"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["pods/log"]
    verbs: ["get"]

---
# RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: ai-trading-rolebinding
  labels:
    app: ai-trading-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: ai-trading-role
subjects:
  - kind: ServiceAccount
    name: ai-trading-sa
