# AI Trading System - Complete Architecture

## 1. Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    DATA FLOW                                            │
└─────────────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐     ┌─────────────────┐     ┌──────────────────────┐
     │   Binance    │     │   CSV Files     │     │   News / Sentiment  │
     │   WebSocket  │     │   (Historical)  │     │   APIs              │
     └──────┬───────┘     └────────┬────────┘     └──────────┬─────────┘
            │                        │                        │
            ▼                        ▼                        ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                      DATA LAYER                                  │
     │  ┌────────────────┐  ┌────────────────┐  ┌─────────────────┐   │
     │  │  data_collector │  │  data_loader   │  │ sentiment_news  │   │
     │  └────────────────┘  └────────────────┘  └─────────────────┘   │
     └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                 TECHNICAL ANALYSIS LAYER                         │
     │  ┌────────────────┐  ┌────────────────┐  ┌─────────────────┐   │
     │  │ RSI, EMA, SMA  │  │ MACD, VWAP     │  │ On-chain        │   │
     │  │ Bollinger Bands│  │ ATR, ADX       │  │ Analysis        │   │
     │  └────────────────┘  └────────────────┘  └─────────────────┘   │
     └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                  ML / SIGNAL LAYER                              │
     │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────┐   │
     │  │ Random Forest│  │ XGBoost       │  │ Ensemble           │   │
     │  │ Classifier   │  │ Model         │  │ (RF + XGB)        │   │
     │  └──────────────┘  └──────────────┘  └────────────────────┘   │
     │  ┌──────────────────────────────────────────────────────────┐  │
     │  │              AutoML Engine                                 │  │
     │  │  - Genetic Algorithm    - Hyperparameter Tuning           │  │
     │  │  - Strategy Evolution   - Walk-Forward Validation         │  │
     │  └──────────────────────────────────────────────────────────┘  │
     └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                    RISK LAYER                                   │
     │  ┌────────────────┐  ┌────────────────┐  ┌─────────────────┐   │
     │  │ Stop Loss      │  │ Take Profit    │  │ Max Drawdown    │   │
     │  │ (ATR-based)    │  │ (ATR-based)    │  │ (Kill-switch)   │   │
     │  └────────────────┘  └────────────────┘  └─────────────────┘   │
     │  ┌────────────────┐  ┌─────────────────────────────────────────┐│
     │  │ Trailing Stop  │  │ Risk Manager (Position Limits, etc.)   ││
     │  └────────────────┘  └─────────────────────────────────────────┘│
     └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                 EXECUTION LAYER                                 │
     │  ┌────────────────┐  ┌────────────────┐  ┌─────────────────┐   │
     │  │ Paper Trading │  │ Live Trading   │  │ Order Manager   │   │
     │  │ (Simulation) │  │ (Binance)      │  │ (Retry Logic)   │   │
     │  └────────────────┘  └────────────────┘  └─────────────────┘   │
     │  ┌──────────────────────────────────────────────────────────┐   │
     │  │              Portfolio Manager                             │   │
     │  │  - Multi-asset      - Position Sizing    - P&L Tracking │   │
     │  └──────────────────────────────────────────────────────────┘   │
     └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
     ┌──────────────────────────────────────────────────────────────────┐
     │                 STORAGE LAYER                                   │
     │  ┌────────────────┐  ┌────────────────┐  ┌─────────────────┐   │
     │  │ SQLite DB      │  │ CSV / Parquet  │  │ Redis Cache     │   │
     │  │ (State)        │  │ (Historical)   │  │ (Real-time)     │   │
     │  └────────────────┘  └────────────────┘  └─────────────────┘   │
     └──────────────────────────────────────────────────────────────────┘
```

---

## 2. Core System Architecture (v2.0)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           TRADING ENGINE ORCHESTRATOR                                │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                          Event Bus (Pub/Sub)                               │   │
│  │   SIGNAL_GENERATED ──► RISK_CHECK ──► ORDER_PLACED ──► ORDER_FILLED      │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────┬────────────────────────────────────────────────┘
                                 │
        ┌────────────────────────┼────────────────────────┐
        ▼                        ▼                        ▼
┌───────────────┐      ┌─────────────────┐      ┌──────────────────┐
│   SIGNAL     │      │   RISK ENGINE   │      │   SCHEDULER      │
│   GENERATOR  │      │                 │      │                  │
│               │      │ - Position Lim │      │ - Retraining     │
│ - RF Model    │      │ - Daily Loss   │      │ - Backtest       │
│ - XGBoost    │      │ - Drawdown     │      │ - Data Update    │
│ - Ensemble    │      │ - Emergency    │      │                  │
└───────┬───────┘      └────────┬────────┘      └──────────────────┘
        │                       │
        ▼                       ▼
┌───────────────┐      ┌─────────────────┐
│ ORDER MANAGER │      │   PORTFOLIO     │
│               │      │   MANAGER       │
│ - Validation  │      │                 │
│ - Retry       │      │ - Positions     │
│ - Execution   │      │ - P&L           │
└───────┬───────┘      │ - Exposure     │
        │              └────────┬────────┘
        ▼                       │
┌───────────────┐               ▼
│   BROKER      │      ┌─────────────────┐
│  INTERFACE    │      │  STATE MANAGER  │
│               │      │                 │
│ - Paper       │      │ - SQLite DB     │
│ - Binance     │      │ - Snapshots     │
│ - Live        │      │ - Recovery      │
└───────────────┘      └─────────────────┘
```

---

## 3. Event-Driven Flow

```
┌──────────────────────────────────────────────────────────────────────┐
│                         EVENT TYPES                                    │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│   ┌─────────────────┐                                               │
│   │ MARKET_DATA     │  Price updates from WebSocket                   │
│   └────────┬────────┘                                               │
│            │                                                         │
│            ▼                                                         │
│   ┌─────────────────┐                                               │
│   │ SIGNAL_GENERATED│  ML model generates trading signal             │
│   └────────┬────────┘                                               │
│            │                                                         │
│            ▼                                                         │
│   ┌─────────────────┐      ┌─────────────────┐                     │
│   │ RISK_CHECK      │─────►│ APPROVED        │                     │
│   └────────┬────────┘      └────────┬────────┘                     │
│            │ REJECTED             │                                │
│            ▼                      ▼                                 │
│   ┌─────────────────┐      ┌─────────────────┐                    │
│   │ SIGNAL_REJECTED │      │ ORDER_PLACED    │                    │
│   └────────┬────────┘      └────────┬────────┘                    │
│            │                      │                                │
│            ▼                      ▼                                │
│   ┌─────────────────┐      ┌─────────────────┐                    │
│   │ ALERT_LOGGED    │      │ ORDER_FILLED    │                    │
│   └────────┬────────┘      └────────┬────────┘                    │
│            │                      │                                │
│            ▼                      ▼                                │
│   ┌─────────────────┐      ┌─────────────────┐                    │
│   │ TELEGRAM_ALERT  │      │ POSITION_UPDATE│                    │
│   └─────────────────┘      └────────┬────────┘                    │
│                                     │                              │
│                                     ▼                              │
│                            ┌─────────────────┐                     │
│                            │ STATE_SAVED    │                     │
│                            └─────────────────┘                     │
│                                                                       │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 4. HFT & Multi-Agent Simulation

```
┌──────────────────────────────────────────────────────────────────────┐
│                    HFT SIMULATOR                                     │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐     │
│   │ Orderbook   │    │ Latency    │    │ Slippage            │     │
│   │ Simulator   │    │ Simulator  │    │ Calculator          │     │
│   └─────────────┘    └─────────────┘    └─────────────────────┘     │
│                                                                       │
│   ┌──────────────────────────────────────────────────────────────┐   │
│   │              RL TRAINING ENVIRONMENT                          │   │
│   │  (Gym-compatible)                                            │   │
│   └──────────────────────────────────────────────────────────────┘   │
│                                                                       │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                    MULTI-AGENT MARKET                               │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│        ┌───────────────┐                                            │
│        │ Market Maker │ ◄── Provides liquidity                       │
│        │   Agent      │                                            │
│        └───────┬───────┘                                            │
│                │                                                      │
│        ┌──────▼───────┐     ┌───────────────┐                       │
│        │    Taker    │◄───►│ Arbitrageur  │                       │
│        │    Agent    │     │   Agent      │                       │
│        └──────┬──────┘     └───────────────┘                       │
│                │                                                      │
│        ┌──────▼──────────────────────────────────────────┐          │
│        │            META-EVOLUTION ENGINE                 │          │
│        │  - Strategy Genome    - Genetic Algorithm         │          │
│        │  - Emergent Communication - Multi-market Migration│          │
│        └──────────────────────────────────────────────────┘          │
│                                                                       │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 5. Dashboard Architecture

```
┌──────────────────────────────────────────────────────────────────────┐
│                    DASHBOARD (Plotly/Dash)                          │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│   ┌────────────────────────────────────────────────────────────────┐ │
│   │                        HEADER                                  │ │
│   │   AI Trading System    │ Status │ Last Update │ User          │ │
│   └────────────────────────────────────────────────────────────────┘ │
│                                                                       │
│   ┌────────────────────────────┐  ┌───────────────────────────────┐  │
│   │    CANDLESTICK CHART      │  │    EQUITY CURVE              │  │
│   │                            │  │                               │  │
│   │   BTCUSDT  1H             │  │   vs Benchmark               │  │
│   │   + Indicators            │  │                               │  │
│   └────────────────────────────┘  └───────────────────────────────┘  │
│                                                                       │
│   ┌────────────────────────────┐  ┌───────────────────────────────┐  │
│   │    DRAWDOWN CHART         │  │    ML METRICS               │  │
│   │                            │  │                               │  │
│   │   Real-time risk          │  │   Accuracy, Confidence      │  │
│   │   visualization           │  │   Top Features              │  │
│   └────────────────────────────┘  └───────────────────────────────┘  │
│                                                                       │
│   ┌────────────────────────────────────────────────────────────────┐ │
│   │                    POSITIONS TABLE                             │ │
│   │  Symbol │ Side │ Qty │ Entry │ Current │ P&L    │ Actions    │ │
│   └────────────────────────────────────────────────────────────────┘ │
│                                                                       │
│   ┌────────────────────────────────────────────────────────────────┐ │
│   │                    AUTO-TRADING PANEL                         │ │
│   │  [Start Live] [Stop] [Paper Mode ▼] [Risk Settings ▼]        │ │
│   └────────────────────────────────────────────────────────────────┘ │
│                                                                       │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 6. Complete System Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                     │
│                              AI TRADING SYSTEM                                      │
│                           Complete Architecture                                      │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                        LAYER 6: USER INTERFACE                              │   │
│  │    ┌─────────────┐  ┌──────────── ┌─────────────┐ ─┐  ┌─────────────┐     │   │
│  │    │  Dashboard  │  │  Telegram   │  │   CLI       │  │  REST API   │     │   │
│  │    │  (Plotly)  │  │  Notifier   │  │  (main.py)  │  │  (Future)   │     │   │
│  │    └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                        │                                              │
│                                        ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                        LAYER 5: ORCHESTRATION                              │   │
│  │    ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │    │                    TRADING ENGINE                               │   │   │
│  │    │  - Event Bus    - State Manager    - Background Tasks           │   │   │
│  │    └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                        │                                              │
│          ┌─────────────────────────────┼─────────────────────────────┐              │
│          ▼                             ▼                             ▼              │
│  ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────────┐         │
│  │ LAYER 4: RISK    │   │ LAYER 3: ML      │   │ LAYER 2: ANALYSIS     │         │
│  │                   │   │                   │   │                       │         │
│  │ Risk Engine      │   │ Random Forest     │   │ Technical Indicators │         │
│  │ - Stop Loss     │   │ XGBoost          │   │ - RSI, EMA, MACD    │         │
│  │ - Take Profit   │   │ Ensemble         │   │ - Bollinger, ATR    │         │
│  │ - Drawdown      │   │ AutoML           │   │ On-chain Analysis   │         │
│  │ - Position Lim  │   │ Walk-Forward     │   │ Sentiment Analysis │         │
│  │ - Emergency     │   │ Meta-Evolution   │   │                     │         │
│  └───────────────────┘   └───────────────────┘   └───────────────────────┘         │
│                                        │                                              │
│                                        ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                        LAYER 1: DATA                                       │   │
│  │    ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │    │  Binance    │  │  CSV Files  │  │  On-chain   │  │    News     │     │   │
│  │    │  WebSocket │  │  Historical │  │   Data      │  │   API       │     │   │
│  │    └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                        STORAGE                                              │   │
│  │    ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │    │  SQLite     │  │  CSV/Parquet│  │  Redis      │  │   Docker    │     │   │
│  │    │  (State)    │  │  (History)  │  │  (Cache)    │  │  Container  │     │   │
│  │    └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Quick Reference

| Layer | Components | Purpose |
|-------|------------|---------|
| **Data** | Binance WebSocket, CSV, APIs | Data collection |
| **Analysis** | Technical Indicators, On-chain | Market analysis |
| **ML** | RF, XGBoost, Ensemble, AutoML | Signal generation |
| **Risk** | Stop Loss, Take Profit, Drawdown | Risk management |
| **Execution** | Broker Interface, Order Manager | Trade execution |
| **Storage** | SQLite, CSV, Redis | Persistence |
| **Interface** | Dashboard, Telegram, CLI | User interaction |

---

## 8. Testing Commands

```bash
# Test core modules
python test_core.py

# Run dashboard
python main.py --mode dashboard

# Run live trading
python main.py --mode live --assets BTCUSDT,ETHUSDT

# Run backtest
python main.py --mode backtest --asset BTCUSDT

# Run tests
python -m pytest tests/ -v
```

---

*Last Updated: 2026-02-18*
*Version: 2.0.0 - Production Ready*
